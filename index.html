<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Subnetting Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f4f7f6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 100%;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .network-info {
            background: #3498db;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            font-size: 1.3em;
            text-align: center;
        }

        .task-section {
            margin-bottom: 30px;
        }

        .task-section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .segments-list {
            background: #ecf0f1;
            padding: 20px 20px 20px 50px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .segments-list li {
            margin: 10px 0;
            font-size: 1.1em;
            color: #333;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.1em;
        }

        .input-group input {
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        input.error {
    border-color: #e74c3c !important;
    background-color: #ffe6e6 !important;
}
        .segment-row input.error {
    border-color: #e74c3c !important;
    background-color: #ffe6e6 !important;
}

        .binary-inputs {
            display: flex;
            gap: 10px;
        }

        .binary-inputs input {
            width: 120px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .subnet-input {
            width: 200px;
        }

        .segment-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 8px;
        }

        .segment-row label {
            min-width: 150px;
            font-weight: 600;
            color: #2c3e50;
        }

        .segment-row input {
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 1em;
        }

        .segment-row .hosts-input {
            width: 120px;
        }

        .segment-row .cidr-input {
            width: 80px;
        }

        .cidr-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-check {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 30px;
            transition: all 0.3s;
        }

        .btn-check:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-check:active {
            transform: translateY(0);
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            text-align: center;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>IP Subnetting Quiz</h1>

        <div class="network-info">
            Netzwerk: <span id="networkDisplay"></span>
        </div>

        <div class="task-section">
            <h2>Deine Aufgabe: Berechne die folgenden Netzwerksegmente:</h2>
            <ul class="segments-list" id="segmentsList"></ul>
        </div>

        <div class="input-group">
            <label>Network Bits:</label>
            <input type="number" id="networkBits" class="subnet-input" min="0" max="32">
        </div>

        <div class="input-group">
            <label>Host Bits:</label>
            <input type="number" id="hostBits" class="subnet-input" min="0" max="32">
        </div>

        <div class="input-group">
            <label>Binär:</label>
            <div class="binary-inputs">
                <input type="text" id="bin1" maxlength="8">
                <input type="text" id="bin2" maxlength="8">
                <input type="text" id="bin3" maxlength="8">
                <input type="text" id="bin4" maxlength="8">
            </div>
        </div>

        <div class="input-group">
            <label>Subnetzmaske:</label>
            <input type="text" id="subnetMask" class="subnet-input" maxlength="15">
        </div>

        <div class="task-section">
            <h2>Nutzbare Hosts:</h2>
            <div id="segmentInputs"></div>
        </div>

        <button class="btn-check" onclick="checkAnswers()">Überprüfen</button>

        <div class="success-message" id="successMessage">
            ✓ Alle Antworten korrekt! Neue Aufgabe wird generiert...
        </div>
    </div>

    <script>
        let currentTask = {};

        function generateIP() {
            const privateRanges = [
                { base: '10', cidr: [16, 17, 18, 19, 20, 21, 22, 23, 24] },
                { base: '172.16', cidr: [20, 21, 22, 23, 24] },
                { base: '192.168', cidr: [24, 25, 26] }
            ];

            const range = privateRanges[Math.floor(Math.random() * privateRanges.length)];
            let ip;

            if (range.base === '10') {
                ip = `10.${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}.0`;
            } else if (range.base === '172.16') {
                ip = `172.${16 + Math.floor(Math.random() * 16)}.${Math.floor(Math.random() * 256)}.0`;
            } else {
                ip = `192.168.${Math.floor(Math.random() * 256)}.0`;
            }

            const cidr = range.cidr[Math.floor(Math.random() * range.cidr.length)];
            return { ip, cidr };
        }

        function generateSegments() {
            const count = Math.floor(Math.random() * 4) + 3;
            const segments = [];

            let previousHosts = 600;

            for (let i = 0; i < count; i++) {
                let hosts;

                if (i === 0) {
                    if (Math.random() < 0.3) {
                        hosts = Math.floor(Math.random() * 250) + 251;
                    } else {
                        hosts = Math.floor(Math.random() * 190) + 60;
                    }
                } else {
                    let maxHosts = Math.min(previousHosts - 5, 250);
                    let minHosts = Math.max(10, maxHosts - 100);
                    hosts = Math.floor(Math.random() * (maxHosts - minHosts)) + minHosts;
                }

                segments.push({ name: `Segment ${i + 1}`, hosts });
                previousHosts = hosts;
            }

            return segments;
        }

        function calculateSubnetMask(cidr) {
            const mask = [];
            for (let i = 0; i < 4; i++) {
                const bits = Math.min(Math.max(cidr - (i * 8), 0), 8);
                mask.push(256 - Math.pow(2, 8 - bits));
            }
            return mask;
        }

        function calculateHostBits(requiredHosts) {
            let bits = 1;
            while (Math.pow(2, bits) - 2 < requiredHosts) {
                bits++;
            }
            return bits;
        }

        function generateNewTask() {
            const network = generateIP();
            const segments = generateSegments();

            currentTask = {
                ip: network.ip,
                cidr: network.cidr,
                networkBits: network.cidr,
                hostBits: 32 - network.cidr,
                subnetMask: calculateSubnetMask(network.cidr).join('.'),
                binary: calculateSubnetMask(network.cidr).map(n => n.toString(2).padStart(8, '0')),
                segments: segments.map(seg => ({
                    ...seg,
                    hostBits: calculateHostBits(seg.hosts),
                    usableHosts: Math.pow(2, calculateHostBits(seg.hosts)) - 2,
                    cidr: 32 - calculateHostBits(seg.hosts)
                }))
            };

            displayTask();
        }

        function displayTask() {
            document.getElementById('networkDisplay').textContent = `${currentTask.ip}/${currentTask.cidr}`;

            const segmentsList = document.getElementById('segmentsList');
            segmentsList.innerHTML = '';
            currentTask.segments.forEach((seg, idx) => {
                const li = document.createElement('li');
                li.textContent = `${seg.name} - ${seg.hosts} Host-Adressen`;
                segmentsList.appendChild(li);
            });

            const segmentInputs = document.getElementById('segmentInputs');
            segmentInputs.innerHTML = '';
            currentTask.segments.forEach((seg, idx) => {
                const row = document.createElement('div');
                row.className = 'segment-row';
                row.innerHTML = `
                    <label>${seg.name}:</label>
                    <input type="number" class="hosts-input" id="hosts${idx}">
                    <div class="cidr-group">
                        <span>CIDR: /</span>
                        <input type="number" class="cidr-input" id="cidr${idx}" min="0" max="32">
                    </div>
                `;
                segmentInputs.appendChild(row);
            });

            clearInputs();
            document.getElementById('successMessage').style.display = 'none';
        }

        function clearInputs() {
            document.getElementById('networkBits').value = '';
            document.getElementById('hostBits').value = '';
            document.getElementById('bin1').value = '';
            document.getElementById('bin2').value = '';
            document.getElementById('bin3').value = '';
            document.getElementById('bin4').value = '';
            document.getElementById('subnetMask').value = '';

            document.querySelectorAll('input').forEach(input => {
                input.classList.remove('error');
            });
        }

        function checkAnswers() {
            let allCorrect = true;

            const networkBitsInput = document.getElementById('networkBits');
            if (parseInt(networkBitsInput.value) !== currentTask.networkBits) {
                networkBitsInput.classList.add('error');
                allCorrect = false;
            } else {
                networkBitsInput.classList.remove('error');
            }

            const hostBitsInput = document.getElementById('hostBits');
            if (parseInt(hostBitsInput.value) !== currentTask.hostBits) {
                hostBitsInput.classList.add('error');
                allCorrect = false;
            } else {
                hostBitsInput.classList.remove('error');
            }

            const binaryInputs = ['bin1', 'bin2', 'bin3', 'bin4'];
            binaryInputs.forEach((id, idx) => {
                const input = document.getElementById(id);
                if (input.value !== currentTask.binary[idx]) {
                    input.classList.add('error');
                    allCorrect = false;
                } else {
                    input.classList.remove('error');
                }
            });

            const subnetMaskInput = document.getElementById('subnetMask');
            if (subnetMaskInput.value !== currentTask.subnetMask) {
                subnetMaskInput.classList.add('error');
                allCorrect = false;
            } else {
                subnetMaskInput.classList.remove('error');
            }

            currentTask.segments.forEach((seg, idx) => {
                const hostsInput = document.getElementById(`hosts${idx}`);
                const cidrInput = document.getElementById(`cidr${idx}`);

                if (parseInt(hostsInput.value) !== seg.usableHosts) {
                    hostsInput.classList.add('error');
                    allCorrect = false;
                } else {
                    hostsInput.classList.remove('error');
                }

                if (parseInt(cidrInput.value) !== seg.cidr) {
                    cidrInput.classList.add('error');
                    allCorrect = false;
                } else {
                    cidrInput.classList.remove('error');
                }
            });

            if (allCorrect) {
                document.getElementById('successMessage').style.display = 'block';
                setTimeout(() => {
                    generateNewTask();
                }, 2000);
            }
        }

        document.getElementById('subnetMask').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^\d]/g, '');
            let formatted = '';

            for (let i = 0; i < value.length && i < 12; i++) {
                if (i > 0 && i % 3 === 0) {
                    formatted += '.';
                }
                formatted += value[i];
            }

            e.target.value = formatted;
        });

        ['bin1', 'bin2', 'bin3', 'bin4'].forEach(id => {
            document.getElementById(id).addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/[^01]/g, '');
            });
        });

        window.onload = generateNewTask;
    </script>
</body>
</html>
