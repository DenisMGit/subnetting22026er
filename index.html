
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2 2026er IP Subnetting Quiz</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f7f6;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      max-width: 980px;
      width: 100%;
    }

    h1 { color: #2c3e50; text-align: center; margin-bottom: 10px; font-size: 2.5em; }

    .network-info {
      background: #3498db;
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      font-size: 1.3em;
      text-align: center;
    }

    .task-section { margin-bottom: 26px; }
    .task-section h2 { color: #2c3e50; margin-bottom: 12px; font-size: 1.4em; }

    .segments-list {
      background: #ecf0f1;
      padding: 20px 20px 20px 50px;
      border-radius: 10px;
      margin-bottom: 18px;
    }

    .segments-list li { margin: 10px 0; font-size: 1.1em; color: #333; }

    .input-group { margin-bottom: 18px; }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #2c3e50;
      font-weight: 600;
      font-size: 1.1em;
    }

    .input-group input {
      padding: 12px;
      border: 2px solid #bdc3c7;
      border-radius: 8px;
      font-size: 1em;
      transition: all 0.3s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .input-group input.error { border-color: #e74c3c; background-color: #ffe6e6; }

    .binary-inputs { display: flex; gap: 10px; flex-wrap: wrap; }

    .binary-inputs input {
      width: 120px;
      text-align: center;
      font-family: 'Courier New', monospace;
    }

    .subnet-input { width: 220px; }


    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .section-header h2 { margin-bottom: 0; }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 0.95em;
      font-weight: 600;
      color: #2c3e50;
      background: #ecf0f1;
      padding: 8px 14px;
      border-radius: 8px;
      user-select: none;
      transition: background 0.2s;
    }

    .checkbox-label:hover { background: #d5d8dc; }

    .checkbox-label input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #3498db;
    }


    .segment-block {
      background: #ecf0f1;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 14px;
      transition: opacity 0.3s;
    }

    .segment-block.disabled {
      opacity: 0.45;
      pointer-events: none;
    }

    .seg-row-1 {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 12px;
    }

    .seg-row-1 label { font-weight: 600; color: #2c3e50; white-space: nowrap; }

    .seg-row-1 input.hosts-input {
      padding: 10px;
      border: 2px solid #bdc3c7;
      border-radius: 6px;
      font-size: 1em;
      width: 100px;
      transition: all 0.3s;
    }

    .cidr-group {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      color: #2c3e50;
    }

    .cidr-group input {
      padding: 10px;
      border: 2px solid #bdc3c7;
      border-radius: 6px;
      font-size: 1em;
      width: 80px;
      transition: all 0.3s;
    }

    .seg-row-1 input.hosts-input:focus,
    .cidr-group input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .seg-row-1 input.error,
    .cidr-group input.error { border-color: #e74c3c; background-color: #ffe6e6; }

    .seg-row-2 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .ip-field { display: flex; flex-direction: column; gap: 5px; }
    .ip-field span { font-size: 0.88em; font-weight: 600; color: #555; }

    .ip-field input {
      padding: 10px;
      border: 2px solid #bdc3c7;
      border-radius: 6px;
      font-size: 0.95em;
      width: 100%;
      transition: all 0.3s;
    }

    .ip-field input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .ip-field input.error { border-color: #e74c3c; background-color: #ffe6e6; }

    .btn-check {
      background: #3498db;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.2em;
      border-radius: 10px;
      cursor: pointer;
      width: 100%;
      margin-top: 22px;
      transition: all 0.3s;
    }

    .btn-check:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }

    .btn-check:active { transform: translateY(0); }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 8px;
      margin-top: 18px;
      display: none;
      text-align: center;
      font-weight: 600;
    }

    @media (max-width: 700px) {
      .seg-row-2 { grid-template-columns: 1fr 1fr; }
      .seg-row-1 { flex-wrap: wrap; }
      .section-header { flex-direction: column; align-items: flex-start; gap: 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>2 2026er IP Subnetting Quiz</h1>

    <div class="network-info">
      Netzwerk: <span id="networkDisplay"></span>
    </div>

    <div class="task-section">
      <h2>Deine Aufgabe: Berechne die folgenden Netzwerksegmente:</h2>
      <ul class="segments-list" id="segmentsList"></ul>
    </div>

    <div class="input-group">
      <label>Network Bits:</label>
      <input type="number" id="networkBits" class="subnet-input" min="0" max="32" placeholder="z.B. 24" />
    </div>

    <div class="input-group">
      <label>Host Bits:</label>
      <input type="number" id="hostBits" class="subnet-input" min="0" max="32" placeholder="z.B. 8" />
    </div>

    <div class="input-group">
      <label>Subnetzmaske (binär):</label>
      <div class="binary-inputs">
        <input type="text" id="bin1" maxlength="8" placeholder="11111111" />
        <input type="text" id="bin2" maxlength="8" placeholder="11111111" />
        <input type="text" id="bin3" maxlength="8" placeholder="11111111" />
        <input type="text" id="bin4" maxlength="8" placeholder="00000000" />
      </div>
    </div>

    <div class="input-group">
      <label>Subnetzmaske (dezimal):</label>
      <input type="text" id="subnetMask" class="subnet-input" maxlength="15" placeholder="255.255.255.0" />
    </div>

    <div class="task-section">
      <div class="section-header">
        <h2>Segmente:</h2>
        <label class="checkbox-label">
          <input type="checkbox" id="segmentsRequired" checked />
          Für Lösung erforderlich?
        </label>
      </div>
      <div id="segmentInputs"></div>
    </div>

    <button class="btn-check" onclick="checkAnswers()">Überprüfen</button>
    <div class="success-message" id="successMessage">✓ Alle Antworten korrekt! Neue Aufgabe wird generiert...</div>
  </div>

  <script>
    let currentTask = {};

    function ipToInt(ip) {
      const p = ip.split('.').map(Number);
      return ((p[0] << 24) >>> 0) + (p[1] << 16) + (p[2] << 8) + p[3];
    }

    function intToIp(n) {
      return [(n >>> 24) & 255, (n >>> 16) & 255, (n >>> 8) & 255, n & 255].join('.');
    }

    function calcMask(cidr) {
      return Array.from({ length: 4 }, (_, i) => {
        const b = Math.min(Math.max(cidr - i * 8, 0), 8);
        return b === 0 ? 0 : 256 - Math.pow(2, 8 - b);
      });
    }

    function hostBitsFor(n) {
      let b = 1;
      while (Math.pow(2, b) - 2 < n) b++;
      return b;
    }

    function rnd(n) { return Math.floor(Math.random() * n); }

    function generateIP() {
      const ranges = [
        { cidr: [16,17,18,19,20,21,22,23,24], gen: () => `10.${rnd(256)}.${rnd(256)}.0` },
        { cidr: [20,21,22,23,24], gen: () => `172.${16+rnd(16)}.${rnd(256)}.0` },
        { cidr: [24,25,26], gen: () => `192.168.${rnd(256)}.0` }
      ];
      const r = ranges[rnd(ranges.length)];
      return { ip: r.gen(), cidr: r.cidr[rnd(r.cidr.length)] };
    }

    function generateSegments() {
      const count = 3 + rnd(4);
      const segs = [];
      let prev = 600;
      for (let i = 0; i < count; i++) {
        let hosts;
        if (i === 0) {
          hosts = Math.random() < 0.3 ? 251 + rnd(250) : 60 + rnd(190);
        } else {
          const max = Math.max(10, Math.min(prev - 5, 250));
          const min = Math.max(10, max - 100);
          hosts = min + rnd(Math.max(1, max - min + 1));
        }
        segs.push({ name: `Segment ${i + 1}`, hosts });
        prev = hosts;
      }
      return segs;
    }

    function buildPlan(baseIp, baseCidr, segments) {
      const maskInt = ipToInt(calcMask(baseCidr).join('.'));
      const baseNet = (ipToInt(baseIp) & maskInt) >>> 0;
      const baseSize = Math.pow(2, 32 - baseCidr);
      const baseEnd = (baseNet + baseSize - 1) >>> 0;
      let cursor = baseNet;
      const planned = [];

      for (const seg of segments) {
        const hb = hostBitsFor(seg.hosts);
        const size = Math.pow(2, hb);
        const aligned = ((cursor + size - 1) & ~(size - 1)) >>> 0;
        const net = aligned;
        const bc = (net + size - 1) >>> 0;
        planned.push({
          name: seg.name,
          requiredHosts: seg.hosts,
          usableHosts: size - 2,
          cidr: 32 - hb,
          network: intToIp(net),
          first: intToIp((net + 1) >>> 0),
          last: intToIp((bc - 1) >>> 0),
          broadcast: intToIp(bc)
        });
        cursor = (bc + 1) >>> 0;
      }

      return { planned, fits: planned.length === 0 || ipToInt(planned.at(-1).broadcast) <= baseEnd };
    }

    function generateNewTask() {
      for (let t = 0; t < 40; t++) {
        const net = generateIP();
        const segs = generateSegments();
        const { planned, fits } = buildPlan(net.ip, net.cidr, segs);
        if (!fits) continue;

        const maskArr = calcMask(net.cidr);
        currentTask = {
          ip: net.ip, cidr: net.cidr,
          networkBits: net.cidr, hostBits: 32 - net.cidr,
          subnetMask: maskArr.join('.'),
          binary: maskArr.map(n => n.toString(2).padStart(8, '0')),
          segments: planned
        };
        break;
      }
      displayTask();
    }

    function updateSegmentState() {
      const required = document.getElementById('segmentsRequired').checked;
      document.querySelectorAll('.segment-block').forEach(block => {
        block.classList.toggle('disabled', !required);
      });
    }

    function displayTask() {
      document.getElementById('networkDisplay').textContent = `${currentTask.ip}/${currentTask.cidr}`;

      const list = document.getElementById('segmentsList');
      list.innerHTML = '';
      currentTask.segments.forEach((seg, i) => {
        const li = document.createElement('li');
        li.textContent = `${i + 1}. ${seg.name} – ${seg.requiredHosts} Host-Adressen`;
        list.appendChild(li);
      });

      const cont = document.getElementById('segmentInputs');
      cont.innerHTML = '';
      currentTask.segments.forEach((seg, i) => {
        const block = document.createElement('div');
        block.className = 'segment-block';
        block.innerHTML = `
          <div class="seg-row-1">
            <label>Segment ${i + 1} – Nutzbare Hosts:</label>
            <input type="number" class="hosts-input" id="hosts${i}" min="0" placeholder="z.B. 62" />
            <div class="cidr-group">
              <span>CIDR: /</span>
              <input type="number" id="cidr${i}" min="0" max="32" placeholder="26" />
            </div>
          </div>
          <div class="seg-row-2">
            <div class="ip-field"><span>Netzadresse</span><input type="text" id="net${i}" maxlength="15" placeholder="192.168.1.0" /></div>
            <div class="ip-field"><span>Erste IP</span><input type="text" id="first${i}" maxlength="15" placeholder="192.168.1.1" /></div>
            <div class="ip-field"><span>Letzte IP</span><input type="text" id="last${i}" maxlength="15" placeholder="192.168.1.62" /></div>
            <div class="ip-field"><span>Broadcast</span><input type="text" id="bc${i}" maxlength="15" placeholder="192.168.1.63" /></div>
          </div>
        `;
        cont.appendChild(block);
      });

      updateSegmentState();
      clearErrors();
      document.getElementById('successMessage').style.display = 'none';
    }

    function clearErrors() {
      document.querySelectorAll('input:not([type="checkbox"])').forEach(el => el.classList.remove('error'));
    }

    function normIp(s) {
      if (!s) return '';
      const parts = s.trim().split('.');
      if (parts.length !== 4) return s.trim();
      const nums = parts.map(p => parseInt(p, 10));
      if (nums.some(Number.isNaN)) return s.trim();
      return nums.join('.');
    }

    function mark(el, ok) { el.classList.toggle('error', !ok); return ok; }

    function checkAnswers() {
      let ok = true;
      const segmentsRequired = document.getElementById('segmentsRequired').checked;

      ok = mark(document.getElementById('networkBits'), parseInt(document.getElementById('networkBits').value) === currentTask.networkBits) && ok;
      ok = mark(document.getElementById('hostBits'), parseInt(document.getElementById('hostBits').value) === currentTask.hostBits) && ok;

      ['bin1','bin2','bin3','bin4'].forEach((id, idx) => {
        ok = mark(document.getElementById(id), document.getElementById(id).value === currentTask.binary[idx]) && ok;
      });

      ok = mark(document.getElementById('subnetMask'), normIp(document.getElementById('subnetMask').value) === currentTask.subnetMask) && ok;

      if (segmentsRequired) {
        currentTask.segments.forEach((seg, i) => {
          ok = mark(document.getElementById(`hosts${i}`), parseInt(document.getElementById(`hosts${i}`).value) === seg.usableHosts) && ok;
          ok = mark(document.getElementById(`cidr${i}`), parseInt(document.getElementById(`cidr${i}`).value) === seg.cidr) && ok;
          ok = mark(document.getElementById(`net${i}`), normIp(document.getElementById(`net${i}`).value) === seg.network) && ok;
          ok = mark(document.getElementById(`first${i}`), normIp(document.getElementById(`first${i}`).value) === seg.first) && ok;
          ok = mark(document.getElementById(`last${i}`), normIp(document.getElementById(`last${i}`).value) === seg.last) && ok;
          ok = mark(document.getElementById(`bc${i}`), normIp(document.getElementById(`bc${i}`).value) === seg.broadcast) && ok;
        });
      }

      if (ok) {
        document.getElementById('successMessage').style.display = 'block';
        setTimeout(() => generateNewTask(), 1800);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('subnetMask').addEventListener('input', function(e) {
        let v = e.target.value.replace(/[^\d]/g, '');
        let f = '';
        for (let i = 0; i < v.length && i < 12; i++) {
          if (i > 0 && i % 3 === 0) f += '.';
          f += v[i];
        }
        e.target.value = f;
      });

      ['bin1','bin2','bin3','bin4'].forEach(id => {
        document.getElementById(id).addEventListener('input', e => {
          e.target.value = e.target.value.replace(/[^01]/g, '');
        });
      });

      document.getElementById('segmentsRequired').addEventListener('change', updateSegmentState);

      generateNewTask();
    });
  </script>
</body>
</html>
